{% extends 'base.html' %}
{% block content %}
<div class="content page">
    <h1>Minggu 3 : Algoritma Genetika - Knapsack Problem</h1>
    <h2>Penjelasan Masalah Knapsack</h2>
    <p>
        Masalah Knapsack (0/1 Knapsack Problem) adalah masalah optimasi kombinatorial klasik. 
        Diberikan sejumlah item dengan berat dan nilai tertentu, serta kapasitas maksimum knapsack, 
        tujuannya adalah memilih item-item yang memberikan nilai total maksimum tanpa melebihi kapasitas.
    </p>

<h3>Data Item</h3>
<table class="data-item-table">
    <thead>
        <tr>
            <th>Item</th>
            <th>Berat (kg)</th>
            <th>Nilai ($)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>A</td>
            <td>7</td>
            <td>5</td>
        </tr>
        <tr>
            <td>B</td>
            <td>2</td>
            <td>4</td>
        </tr>
        <tr>
            <td>C</td>
            <td>1</td>
            <td>7</td>
        </tr>
        <tr>
            <td>D</td>
            <td>9</td>
            <td>2</td>
        </tr>
    </tbody>
</table>

<p><strong>Kapasitas Maksimum Knapsack: 15 kg</strong></p>


    <h2>Konsep Algoritma Genetika</h2>
    <p>
        Algoritma Genetika (GA) adalah metode pencarian heuristik yang terinspirasi dari proses evolusi alami. 
        GA menggunakan teknik seperti seleksi, crossover (perkawinan silang), dan mutasi untuk mencari solusi optimal.
    </p>

    <div class="rumus">
        <strong>Representasi Kromosom:</strong> [A, B, C, D] ‚Üí [1, 0, 1, 1]<br>
        1 = item dipilih, 0 = item tidak dipilih
    </div>

    <h3>Langkah-langkah Algoritma Genetika:</h3>
    <ol style="text-align: left; margin-left: 20px; line-height: 2;">
        <li><strong>Inisialisasi Populasi:</strong> Generate kromosom acak</li>
        <li><strong>Evaluasi Fitness:</strong> Hitung nilai setiap kromosom</li>
        <li><strong>Seleksi:</strong> Pilih indiviu terbaik (Roulette Wheel Selection)</li>
        <li><strong>Crossover:</strong> Kawinkan silang dua induk</li>
        <li><strong>Mutasi:</strong> Flip bit secara acak</li>
        <li><strong>Elitism:</strong> Pertahankan individu terbaik</li>
        <li><strong>Iterasi:</strong> Ulangi sampai generasi maksimum</li>
    </ol>

    <h2>Pengaturan Parameter</h2>
    <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; margin: 20px 0;">
        <div style="margin-bottom: 15px;">
            <label style="display: inline-block; width: 200px;"><strong>Ukuran Populasi:</strong></label>
            <input type="number" id="pop_size" value="8" min="2" max="100" 
                   style="padding: 8px; border-radius: 4px; border: none; width: 100px;">
        </div>
        <div style="margin-bottom: 15px;">
            <label style="display: inline-block; width: 200px;"><strong>Jumlah Generasi:</strong></label>
            <input type="number" id="generations" value="8" min="1" max="100" 
                   style="padding: 8px; border-radius: 4px; border: none; width: 100px;">
        </div>
        <div style="margin-bottom: 15px;">
            <label style="display: inline-block; width: 200px;"><strong>Crossover Rate:</strong></label>
            <input type="number" id="crossover_rate" value="0.8" min="0" max="1" step="0.1" 
                   style="padding: 8px; border-radius: 4px; border: none; width: 100px;">
        </div>
        <div style="margin-bottom: 15px;">
            <label style="display: inline-block; width: 200px;"><strong>Mutation Rate:</strong></label>
            <input type="number" id="mutation_rate" value="0.1" min="0" max="1" step="0.1" 
                   style="padding: 8px; border-radius: 4px; border: none; width: 100px;">
        </div>
        <button onclick="runGA()" style="margin-top: 10px;">Jalankan Algoritma Genetika</button>
    </div>

    <div id="loading" style="display: none; text-align: center; margin: 20px 0;">
        <p>‚è≥ Memproses algoritma genetika...</p>
    </div>

    <div id="results" style="margin-top: 30px;"></div>
</div>

<script>
async function runGA() {
    const popSize = document.getElementById('pop_size').value;
    const generations = document.getElementById('generations').value;
    const crossoverRate = document.getElementById('crossover_rate').value;
    const mutationRate = document.getElementById('mutation_rate').value;

    const loading = document.getElementById('loading');
    const results = document.getElementById('results');
    
    loading.style.display = 'block';
    results.innerHTML = '';

    try {
        const response = await fetch('/run_ga', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                pop_size: popSize,
                generations: generations,
                crossover_rate: crossoverRate,
                mutation_rate: mutationRate
            })
        });

        const data = await response.json();
        
        if (data.success) {
            displayResults(data.data);
        }
    } catch (error) {
        console.error('Error:', error);
        results.innerHTML = '<p style="color: #ff6b6b;">Terjadi kesalahan saat menjalankan algoritma.</p>';
    } finally {
        loading.style.display = 'none';
    }
}

function displayResults(data) {
    const results = document.getElementById('results');
    
    let html = '<h2>Hasil Evolusi Per Generasi</h2>';
    html += '<div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 30px;">';
    
    data.generations.forEach(gen => {
        html += `
            <div style="background: rgba(255,255,255,0.1); padding: 12px; margin-bottom: 10px; border-radius: 6px; border-left: 4px solid #ffdd57;">
                <strong>Generasi ${gen.generation}</strong><br>
                <span style="font-family: 'Courier New', monospace;">Kromosom: [${gen.chromosome.join(', ')}]</span><br>
                Item Terpilih: <strong>${gen.items.join(', ') || 'Tidak ada'}</strong><br>
                Total Berat: ${gen.weight} kg | Total Nilai: $${gen.value} | Fitness: ${gen.fitness}
            </div>
        `;
    });
    
    html += '</div>';
    
    html += '<h2>üèÜ HASIL AKHIR TERBAIK</h2>';
    html += `
        <div style="background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,140,0,0.2)); 
                    padding: 25px; border-radius: 10px; border: 3px solid #ffd700; margin-top: 20px;">
            <p style="font-size: 1.2rem;"><strong>Kromosom Terbaik:</strong> 
               <span style="font-family: 'Courier New', monospace; background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 4px;">
               [${data.final.chromosome.join(', ')}]</span></p>
            <p style="font-size: 1.2rem;"><strong>Item Terpilih:</strong> ${data.final.items.join(', ')}</p>
            <p style="font-size: 1.2rem;"><strong>Total Berat:</strong> ${data.final.weight} kg / 15 kg</p>
            <p style="font-size: 1.3rem; color: #ffd700;"><strong>Total Nilai:</strong> $${data.final.value}</p>
            <p style="font-size: 1.2rem;"><strong>Fitness Akhir:</strong> ${data.final.fitness}</p>
        </div>
    `;
    
    results.innerHTML = html;
}
</script>
{% endblock %}